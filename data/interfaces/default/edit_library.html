<%doc>
USAGE DOCUMENTATION :: PLEASE LEAVE THIS AT THE TOP OF THIS FILE

For Mako templating syntax documentation please visit: http://docs.makotemplates.org/en/latest/

Filename:           edit_library.html
Version:            0.1
Variable names:     data [list]

data :: Usable parameters

== Global keys ==
section_id          Returns the library id of the library.
section_name        Returns the name of the library.
section_type        Returns the type of the library.
library_thumb       Returns the thumbnail for the library.
custom_thumb        Returns the custom thumbnail for the library.
library_art         Returns the artwork for the library.
count               Returns the item count for the library.
parent_count        Returns the parent item count for the library.
child_count         Returns the child item count for the library.
do_notify           Returns bool value for whether to send notifications for the library.
keep_history        Returns bool value for whether to keep history for the library.
deleted_section     Returns bool value for whether the library is marked as deleted.

DOCUMENTATION :: END
</%doc>

<%!
    from plexpy import helpers
%>

% if data != None:
<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-remove"></i></button>
            <h4 class="modal-title">编辑库 <strong>${data['section_name']}</strong></h4>
        </div>
        <div class="modal-body" id="modal-text">
            <fieldset>
                <div class="form-group">
                    <label for="profile_url">库缩略图 URL</label>
                    <div class="row">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="custom_thumb_url" name="custom_thumb_url" value="${data['library_thumb']}">
                        </div>
                    </div>
                    <p class="help-block">在 Tautulli 中更改库的缩略图。要重置为默认值，请将此字段留空并保存。</p>
                </div>
                <div class="form-group">
                    <label for="profile_url">库背景艺术 URL</label>
                    <div class="row">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="custom_art_url" name="custom_art_url" value="${data['library_art']}">
                        </div>
                    </div>
                    <p class="help-block">在 Tautulli 中更改库的背景艺术。要重置为默认值，请将此字段留空并保存。</p>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" id="keep_history" name="keep_history" value="1" ${helpers.checked(data['keep_history'])}> 保留历史记录
                    </label>
                    <p class="help-block">如果你不想保留此库的任何活动历史，请取消选中此选项。</p>
                </div>
                % if data['section_id']:
                <div class="form-group">
                    <button class="btn btn-danger" id="delete-all-history">清除</button>
                    <p class="help-block">危险区域！点击清除按钮以删除此库记录的所有历史。这是永久性的！</p>
                </div>
                % endif
                % if data['deleted_section']:
                <div class="form-group">
                    <button class="btn btn-bright" id="undelete-library">撤销删除</button>
                    <p class="help-block">点击以重新将该库添加到 Tautulli 库列表中。</p>
                </div>
                % endif
            </fieldset>
        </div>
        <div class="modal-footer">
            <div>
                <span id="edit-library-status-message"></span>
                <input type="button" id="save_library" class="btn btn-bright" value="保存">
            </div>
        </div>
    </div>
</div>
<script>
    // Save library options
    $("#save_library").on('click', function () {
        var custom_thumb = $("#custom_thumb_url").val();
        var custom_art = $("#custom_art_url").val();
        var keep_history = 0;
        if ($("#keep_history").is(":checked")) {
            keep_history = 1;
        }

        $.ajax({
            url: 'edit_library',
            data: {
                section_id: '${data["section_id"]}',
                custom_thumb: custom_thumb,
                custom_art: custom_art,
                keep_history: keep_history
            },
            cache: false,
            async: true,
            success: function (data) {
                location.reload();
            }
        });
    });

    $('#delete-all-history').click(function () {
        var msg = '你真的确定要清除 <strong>${data["section_name"]}</strong> 库的所有历史记录吗？<br> 这是永久性的，无法撤销！';
        var url = 'delete_all_library_history';
        confirmAjaxCall(url, msg, { server_id: '${server_id}', section_id: '${data["section_id"]}' }, null, function () { location.reload(); });
    });

    $('#undelete-library').click(function () {
        var msg = '你确定要恢复删除这个库吗？';
        var url = 'undelete_library';
        confirmAjaxCall(url, msg, { section_id: '${data["section_id"]}' }, null, function () { location.reload(); });
    });
</script>
% endif